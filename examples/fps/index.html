<!DOCTYPE html>
<html lang="en">
    <head>
        <title>fps</title>
        <meta charset="utf-8">
        <script type="text/javascript" src="../../build/source/ig-all.js"></script>
    </head>
    <body>
        <div id="frame-count"></div>
        <div id="real-fps"></div>
        <br>
        <br>
        <br>
        <br>
        <div id="frame-count2"></div>
        <div id="real-fps2"></div>
        <script>
            var counter1;
            var first1;
            var g = new ig.Game();
            g.start(function (data) {
                counter1 = 0;
                first1 = data.data.startTime;
            }).on('gameFPS', function (data) {
                document.querySelector('#real-fps').innerHTML = 'realFps: '+ data.data.fps;
            }).on('afterGameRender', function (data) {
                var timeEl = (data.data.startTime - first1) / 1000;
                document.querySelector('#frame-count').innerHTML =
                    ++counter1 + 'f / ' + parseInt(timeEl) + 's = ' + parseInt(counter1/timeEl) + 'fps';
            });

            console.warn(g);
            console.warn(ig);

            // setTimeout(function () {
            //     var counter2;
            //     var first2;
            //     var g2 = new ig.Game();
            //     g2.start(function (data) {
            //         console.warn(1);
            //         counter2 = 0;
            //         first2 = data.data.startTime;
            //     }).on('gameFPS', function (data) {
            //         document.querySelector('#real-fps2').innerHTML = 'realFps2: '+ data.data.fps;
            //     }).on('afterGameRender', function (data) {
            //         var timeEl2 = (data.data.startTime - first2) / 1000;
            //         document.querySelector('#frame-count2').innerHTML =
            //             ++counter2 + 'f / ' + parseInt(timeEl2) + 's = ' + parseInt(counter2/timeEl2) + 'fps';
            //     });
            // }, 1000);

            // console.warn(g, g2);

            // setTimeout(function () {
            //     g.stop();
            //     setTimeout(function () {
            //         g.start(function (data) {
            //             counter = 0;
            //             first = data.data.startTime;
            //         });
            //     }, 2000);
            // }, 3000)


            // var fps = 30;
            // var now;
            // var then = Date.now();
            // var interval = 1000/fps;
            // var delta;

            // // For this demo
            // var counter = 0;
            // var first = then;

            // var second_since = Date.now();
            // var second = 0;
            // var second_fps = 0;

            // function draw() {

            //     requestAnimationFrame(draw);

            //     // Calculating REAL FPS
            //     if (second > 1000) {
            //         second_since = Date.now();
            //         second = 0;

            //         document.querySelector('#real-fps').innerHTML = second_fps;

            //         second_fps = 0;
            //     }
            //     else {
            //         second = Date.now() - second_since;
            //         ++second_fps;
            //     }

            //     now = Date.now();
            //     delta = now - then; // 时间差即每帧的时间间隔。
            //     // console.log(delta);

            //     if (delta > interval) {
            //         // 仅仅 `then = now` 的判断是不够的，
            //         // 例如设置 fps = 10，意味着每帧必须是 100ms，而现在帧执行时间是 16ms (60 fps)
            //         // 所以需要循环 7 次 (16 * 7 = 112ms) 才能满足 `delta > interval === true`。
            //         // 这会导致降低了FPS， 112 * 10 = 1120ms (不是 1000ms)
            //         // 因此这里 `delta % interval`
            //         then = now - (delta % interval);

            //         // ... Code for Drawing the Frame ...
            //         var time_el = (then - first) / 1000;

            //         document.querySelector('#frame-count').innerHTML = ++counter + 'f / ' + parseInt(time_el) + 's = ' + parseInt(counter/time_el) + 'fps';
            //     }
            // }
            // draw();

        </script>
    </body>
</html>
