<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Matrix</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
        <meta name="format-detection" content="telephone=no">
        <meta name="apple-mobile-web-app-capable" content="yes"/>
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <meta name="full-screen" content="true"/>
        <meta name="screen-orientation" content="portrait"/>
        <meta name="x5-fullscreen" content="true"/>
        <meta name="360-fullscreen" content="true"/>

        <script type="text/javascript" src="../../build/source/ig-all.js"></script>
        <style type="text/css">
            canvas {
                border: 1px solid #ddd;
            }
        </style>
    </head>
    <body>
        <!-- <ul>
            <li><a href="###">111111</a></li>
        </ul> -->
        <canvas width="800" height="400"></canvas>
        <script type="text/javascript">

            var Matrix = ig.Matrix;
            var canvas = document.querySelector('canvas');
            var ctx = canvas.getContext('2d');
            var width = canvas.width;
            var height = canvas.height;

            var matrix = new Matrix();

            var angle = 0;
            var scale = 0.01;
            var isAdd = true;
            var points = [
                {
                    x: 200,
                    y: 150
                },
                {
                    x: 250,
                    y: 210
                },
                {
                    x: 180,
                    y: 200
                },
            ];

            var originalPoints = ig.util.extend(true, [], points);
            setInterval(function () {
                var m = matrix.reset().m;
                // ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
                ctx.clearRect(0, 0, width, height);
                ctx.save();

                // matrix.translate(120, 120);
                // matrix.rotate(angle);
                // matrix.scale(scale, scale);
                // ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
                // ctx.fillStyle = 'red';
                // ctx.fillRect(-50, -50, 100, 100);

                // var m = matrix.reset().m;
                // ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
                // matrix.translate(300, 120);
                // matrix.rotate(-(angle + 60));
                // matrix.scale(scale, scale);
                // ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
                // ctx.fillStyle = 'green';
                // ctx.fillRect(-90, -80, 180, 160);

                ctx.beginPath();
                // var m = matrix.reset().m;
                // ctx.setTransform(m[0], m[1], m[2], m[3], m[4], m[5]);
                matrix.translate(300, 120);
                matrix.rotate(angle);
                // console.warn(m);
                // ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);

                // debugger
                for (var i = 0, len = points.length; i < len; i++) {
                    // var pos = [points[i].x, points[i].y];
                    points[i] = matrix.transformPoint(originalPoints[i].x, originalPoints[i].y);
                    // var out = matrix.mulVector([], m, pos);
                    // p[i].x = out[0];
                    // p[i].y = out[1];
                }
                // console.warn(points[0]);
                // console.warn(originalPoints);

                ctx.moveTo(points[0].x, points[0].y);
                for (var i = 0, len = points.length; i < len; i++) {
                    ctx.lineTo(points[i].x, points[i].y);
                }
                ctx.closePath();
                ctx.stroke();
                ctx.restore();

                angle = angle + 1;

                if (isAdd) {
                    scale = scale + 0.01;
                }
                else {
                    scale = scale - 0.01;
                }

                if (scale >= 1) {
                    isAdd = false;
                }

                if (scale <= 0.01) {
                    isAdd = true;
                }
            }, 1000 / 60);
        </script>
    </body>
</html>
