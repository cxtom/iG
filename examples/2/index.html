<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Title</title>
        <style>
            body {
                margin: 0;
                padding: 0;
                background: #ddd;
            }

            .container {
                position: relative;
                width: 800px;
                height: 400px;
                margin: 10px auto;
                background: #fff;
                border: thin inset rgba(100,150,230,0.5);
            }

            #readout {
                margin-top: 10px;
                margin-left: 15px;
                color: blue;
            }
        </style>
        <script type="text/javascript" src="../../build/source/ig-all.js"></script>
    </head>
    <body>
        <div class="container">
            <canvas id='canvas' width='800' height='400'></canvas>
        </div>
        <script>

            // var imageLoader = new ig.ImageLoader();
            // imageLoader.addImage([
            //     './img/mute_35x35.png',
            //     './img/thinNumbers_25x32.png',
            //     './img/fatNumbers_33x41.png',
            //     './img/pop_156x141.png',
            //     './img/dots_64x86.png',
            //     './img/panels_383x550.png',
            //     './img/quitBut.png',
            //     './img/playBut.png',
            //     './img/hud.png',
            //     './img/rotateDeviceMessage.jpg',
            //     './img/bg.jpg',
            //     './img/sprite-sheet-test.png',
            //     './img/sprite-sheet-test1.png',
            //     './img/sprite-sheet-test2.png',
            //     './img/sprite-sheet-test3.jpg',
            //     './img/sprite-sheet-test4.png',
            //     './img/sprite-sheet-test5.png',
            //     './img/sprite-sheet-test6.png',
            //     './img/sprite-sheet-test7.jpg',
            //     './img/sprite-sheet-test8.png',
            // ]);

            // var interval = setInterval(function (e) {
            //     var percent = imageLoader.loadImages();
            //     console.warn(percent.toFixed());

            //     if (percent >= 100) {
            //         clearInterval(interval);
            //     }
            // }, 16);

            var canvas = document.querySelector('#canvas');
            var ctx = canvas.getContext('2d');

            var g = new ig.Game();

            g.on('Game:afterRender', function (data) {
                console.log(
                    '最大帧数：' + data.data.maxFrame,
                    '最小帧数：' + data.data.minFrame,
                    '当前帧数：' + data.data.curFrame
                );
            });

            function Ball(opts) {
                ig.DisplayObject.apply(this, arguments);
                this.r = opts.r || 10;
                this.color = '#fff';
            }

            Ball.prototype.constructor = Ball;
            Ball.prototype.update = function () {
                var w = this.stageOwner.width;
                var h = this.stageOwner.height;
                if (this.x < this.r || this.x > w - this.r) {
                    this.vX = -this.vX;
                };
                if (this.y < this.r || this.y > h - this.r) {
                    this.vY = -this.vY;
                }
                // this.moveStep();
                Ball.superClass.update.call(this);
                // this.constructor.prototype.update();
            };
            Ball.prototype.render = function(ctx) {
                ctx.beginPath();
                ctx.fillStyle = this.color;
                ctx.arc(this.x,this.y,this.r-3,0,Math.PI*2);
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.strokeStyle ="white";
                ctx.arc(this.x,this.y,this.r,0,Math.PI*2);
                ctx.stroke();
                Ball.superClass.render.apply(this, arguments);
            };

            ig.util.inherits(Ball, ig.DisplayObject);

            var stage = g.createStage({
                width: 1000,
                height: 500,
                // containerBgColor: 'rgba(255, 0, 0, .1)',
                // containerBgColor: '#fff',
                containerBgColor: 'white',
                canvas: document.querySelector('#canvas')
            });

            // stage.on('Stage:beforeRender', function (data) {
            //     console.log('Stage:beforeRender');
            // });

            // stage.on('Stage:beforeRender', function (data) {
            //     console.log('Stage:afterRender');
            // });

            for (var i = 0; i < 10; i++) {
                var obj = new Ball({
                    name: i,
                    r: 10
                });
                obj.move(ig.util.randomInt(20, 400), ig.util.randomInt(20, 300));
                obj.vX = ig.util.randomInt(5, 10);
                obj.vY = ig.util.randomInt(5, 10);
                obj.color = 'red';
                stage.addDisplayObject(obj);

                // obj.on('DisplayObject:render', function (data) {
                //     console.log('DisplayObject:render', data);
                // });
            }

            g.start();
            console.warn(g);
            console.warn(g.getStageStack());
            console.warn(g.getCurrentStage());

            setTimeout(function () {
                // g.pause();
                // alert('变化场景');
                g.getCurrentStage().setContainerBgImg('./img/bg.jpg', 'full');
                setTimeout(function () {
                //     alert('又变了');
                    g.getCurrentStage().setContainerBgImg('./img/bg1.jpg', 'full');
                //     // g.pause();
                    setTimeout(function () {
                        g.pause();
                    }, 3000);
                }, 3000);
            }, 3000);

        </script>
    </body>
</html>
