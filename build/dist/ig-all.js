!function(e){var t,a;!function(){function e(e,t){if(!t)return e;if(0===e.indexOf(".")){var a=t.split("/"),n=e.split("/"),i=a.length-1,r=n.length,o=0,s=0;e:for(var c=0;r>c;c++)switch(n[c]){case"..":if(!(i>o))break e;o++,s++;break;case".":s++;break;default:break e}return a.length=i-o,n=n.slice(s),a.concat(n).join("/")}return e}function n(t){function a(a,o){if("string"==typeof a){var s=n[a];return s||(s=r(e(a,t)),n[a]=s),s}a instanceof Array&&(o=o||function(){},o.apply(this,i(a,o,t)))}var n={};return a}function i(a,n,i){for(var s=[],c=o[i],u=0,l=Math.min(a.length,n.length);l>u;u++){var h,d=e(a[u],i);switch(d){case"require":h=c&&c.require||t;break;case"exports":h=c.exports;break;case"module":h=c;break;default:h=r(d)}s.push(h)}return s}function r(e){var t=o[e];if(!t)throw new Error("No "+e);if(!t.defined){var a=t.factory,n=a.apply(this,i(t.deps||[],a,e));"undefined"!=typeof n&&(t.exports=n),t.defined=1}return t.exports}var o={};a=function(e,t,a){o[e]={id:e,deps:t,factory:a,defined:0,exports:{},require:n(e)}},t=n("")}(),a("ig",["ig/ig"],function(e){return e}),a("ig/ig",["require"],function(){"use strict";window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){var t,a,n=this;setTimeout(function(){t=+new Date,e(t),a=+new Date,n.timeout=1e3/60-(a-t)},n.timeout)}}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.clearTimeout}();var e={};return e}),a("ig/util",["require"],function(){"use strict";var e=Math.PI/180,t=180/Math.PI,a=Object.prototype,n={};return n.noop=function(){},n.extend=function(e,t){for(var a=1,n=arguments.length;n>a;a++)if(t=arguments[a])for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},n.inherits=function(e,t){var a=function(){};a.prototype=t.prototype;var n=e.prototype,i=e.prototype=new a;for(var r in n)i[r]=n[r];return e.prototype.constructor=e,e.superClass=t.prototype,e},n.deg2Rad=function(t){return t*e},n.rad2Deg=function(e){return e*t},n.window2Canvas=function(e,t,a){var n=e.getBoundingClientRect();return{x:Math.round(t-n.left*(e.width/n.width)),y:Math.round(a-n.top*(e.height/n.height))}},n.fastApply=function(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2]);case 4:return e.call(t,a[0],a[1],a[2],a[3]);case 5:return e.call(t,a[0],a[1],a[2],a[3],a[4]);case 6:return e.call(t,a[0],a[1],a[2],a[3],a[4],a[5]);case 7:return e.call(t,a[0],a[1],a[2],a[3],a[4],a[5],a[6]);case 8:return e.call(t,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]);case 9:return e.call(t,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]);default:return e.apply(t,a)}},n.removeArrByCondition=function(e,t){for(var a,n=-1,i=0,r=e.length;r>i;i++)if(a=e[i],t(a)){n=i;break}-1!==n&&e.splice(n,1)},n.parseColor=function(e,t){return t===!0?"number"==typeof e?0|e:("string"==typeof e&&"#"===e[0]&&(e=e.slice(1)),parseInt(e,16)):("number"==typeof e&&(e="#"+("00000"+(0|e).toString(16)).substr(-6)),e)},n.colorToRGB=function(e,t){"string"==typeof e&&"#"===e[0]&&(e=window.parseInt(e.slice(1),16)),t=void 0===t?1:t;var a=e>>16&255,n=e>>8&255,i=255&e,r=0>t?0:t>1?1:t;return 1===r?"rgb("+a+","+n+","+i+")":"rgba("+a+","+n+","+i+","+r+")"},n.randomInt=function(e,t){return Math.floor(Math.random()*t+e)},n.randomFloat=function(e,t){return Math.random()*(t-e)+e},n.domWrap=function(e,t,a){return e.parentNode.insertBefore(t,e),t.appendChild(e),t.id=a,e},n.getType=function(e){var t=a.toString.call(e),n=/\[object (\w+)\]/.exec(t);return n[1].toLowerCase()},n.windowToCanvas=function(e,t,a){var n=e.getBoundingClientRect(),i=e.width,r=e.height;return{x:Math.round(t-n.left*(i/n.width)),y:Math.round(a-n.top*(r/n.height))}},n.getMouseCoords=function(e,t){var a=e.getBoundingClientRect(),n=a.top,i=a.bottom,r=a.left,o=a.right,s=getComputedStyle(e,null);if(s){var c=parseInt(s.getPropertyValue("border-top-width"),10),u=parseInt(s.getPropertyValue("border-right-width"),10),l=parseInt(s.getPropertyValue("border-bottom-width"),10),h=parseInt(s.getPropertyValue("border-left-width"),10);r+=h,o-=u,n+=c,i-=l}var d={};d.x=t.clientX-r,d.y=t.clientY-n;var f=o-r;if(e.width!==f){var g=i-n;d.x=d.x*(e.width/f),d.y=d.y*(e.height/g)}return d},n.captureMouse=function(e){var t={x:0,y:0,event:null},a=document.body.scrollLeft,n=document.documentElement.scrollLeft,i=document.body.scrollTop,r=document.documentElement.scrollTop,o=e.offsetLeft,s=e.offsetTop;return e.addEventListener("mousemove",function(e){var c,u;e.pageX||e.pageY?(c=e.pageX,u=e.pageY):(c=e.clientX+a+n,u=e.clientY+i+r),c-=o,u-=s,t.x=c,t.y=u,t.event=e,console.warn(t)},!1),t},n.captureTouch=function(e){var t={x:null,y:null,isPressed:!1,event:null},a=document.body.scrollLeft,i=document.documentElement.scrollLeft,r=document.body.scrollTop,o=document.documentElement.scrollTop,s=e.offsetLeft,c=e.offsetTop;return e.addEventListener("touchstart",function(e){t.isPressed=!0,t.event=e,console.warn(t,"touchstart")},!1),e.addEventListener("touchend",function(e){t.isPressed=!1,t.x=null,t.y=null,t.event=e,console.warn(t,"touchend")},!1),e.addEventListener("touchmove",function(e){var u,l,h=e.touches[0];h.pageX||h.pageY?(u=h.pageX,l=h.pageY):(u=h.clientX+a+i,l=h.clientY+r+o),u-=s,l-=c,t.x=u,t.y=l,t.event=e,console.log(n.getMouseCoords(t.event.target,h))},!1),t},n}),a("ig/Event",["require"],function(){"use strict";function e(){this._events={}}var t="_observerGUID";return e.prototype={constructor:e,on:function(e,a){this._events||(this._events={});var n=this._events[e];return n||(n=this._events[e]=[]),a.hasOwnProperty(t)||(a[t]=+new Date),n.push(a),this},un:function(e,t){if(this._events){if(!t)return void(this._events[e]=[]);var a=this._events[e];if(a)for(var n=0;n<a.length;n++)a[n]===t&&(a.splice(n,1),n--);return this}},fire:function(e,a){1===arguments.length&&"object"==typeof e&&(a=e,e=a.type);var n=this["on"+e];if("function"==typeof n&&n.call(this,a),this._events){null==a&&(a={}),"[object Object]"!==Object.prototype.toString.call(a)&&(a={data:a}),a.type=e,a.target=this;var i={},r=this._events[e];if(r){r=r.slice();for(var o=0;o<r.length;o++){var s=r[o];i.hasOwnProperty(s[t])||s.call(this,a)}}if("*"!==e){var c=this._events["*"];if(!c)return;c=c.slice();for(var o=0;o<c.length;o++){var s=c[o];i.hasOwnProperty(s[t])||s.call(this,a)}}}},enable:function(t){t._events={},t.on=e.prototype.on,t.un=e.prototype.un,t.fire=e.prototype.fire}},e}),a("ig/env",["require"],function(){"use strict";function e(e){var t={},a={},n=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),i=e.match(/(Android);?[\s\/]+([\d.]+)?/),r=!!e.match(/\(Macintosh\; Intel /),o=e.match(/(iPad).*OS\s([\d_]+)/),s=e.match(/(iPod)(.*OS\s([\d_]+))?/),c=!o&&e.match(/(iPhone\sOS)\s([\d_]+)/),u=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),l=e.match(/Windows Phone ([\d.]+)/),h=u&&e.match(/TouchPad/),d=e.match(/Kindle\/([\d.]+)/),f=e.match(/Silk\/([\d._]+)/),g=e.match(/(BlackBerry).*Version\/([\d.]+)/),m=e.match(/(BB10).*Version\/([\d.]+)/),v=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),p=e.match(/PlayBook/),w=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),y=e.match(/Firefox\/([\d.]+)/),b=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),x=!w&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),S=x||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/),C=e.match(/MicroMessenger\/([\d.]+)/),O=e.match(/baiduboxapp\/[^\/]+\/([\d.]+)_/)||e.match(/baiduboxapp\/([\d.]+)/)||e.match(/BaiduHD\/([\d.]+)/)||e.match(/FlyFlow\/([\d.]+)/)||e.match(/baidubrowser\/([\d.]+)/),I=e.match(/MQQBrowser\/([\d.]+)/)||e.match(/QQ\/([\d.]+)/),k=e.match(/UCBrowser\/([\d.]+)/),j=e.match(/SogouMobileBrowser\/([\d.]+)/),Y=i&&e.match(/MiuiBrowser\/([\d.]+)/),X=e.match(/LBKIT/),A=e.match(/Mercury\/([\d.]+)/);return(a.webkit=!!n)&&(a.version=n[1]),i&&(t.android=!0,t.version=i[2]),c&&!s&&(t.ios=t.iphone=!0,t.version=c[2].replace(/_/g,".")),o&&(t.ios=t.ipad=!0,t.version=o[2].replace(/_/g,".")),s&&(t.ios=t.ipod=!0,t.version=s[3]?s[3].replace(/_/g,"."):null),l&&(t.wp=!0,t.version=l[1]),u&&(t.webos=!0,t.version=u[2]),h&&(t.touchpad=!0),g&&(t.blackberry=!0,t.version=g[2]),m&&(t.bb10=!0,t.version=m[2]),v&&(t.rimtabletos=!0,t.version=v[2]),p&&(a.playbook=!0),d&&(t.kindle=!0,t.version=d[1]),f&&(a.silk=!0,a.version=f[1]),!f&&t.android&&e.match(/Kindle Fire/)&&(a.silk=!0),w&&(a.chrome=!0,a.version=w[1]),y&&(a.firefox=!0,a.version=y[1]),b&&(a.ie=!0,a.version=b[1]),S&&(r||t.ios)&&(a.safari=!0,r&&(a.version=S[1])),x&&(a.webview=!0),C&&(a.wechat=!0,a.version=C[1]),O&&(delete a.webview,a.baidu=!0,a.version=O[1]),I&&(a.qq=!0,a.version=I[1]),k&&(delete a.webview,a.uc=!0,a.version=k[1]),j&&(delete a.webview,a.sogou=!0,a.version=j[1]),Y&&(a.xiaomi=!0,a.version=Y[1]),X&&(a.liebao=!0,a.version="0"),A&&(a.mercury=!0,a.version=A[1]),navigator.standalone&&(a.standalone=!0),t.tablet=!!(o||p||i&&!e.match(/Mobile/)||y&&e.match(/Tablet/)||b&&!e.match(/Phone/)&&e.match(/Touch/)),t.phone=!(t.tablet||t.ipod||!(i||c||u||g||m||w&&e.match(/Android/)||w&&e.match(/CriOS\/([\d.]+)/)||y&&e.match(/Mobile/)||b&&e.match(/Touch/))),{browser:a,os:t}}function t(e){e.audioData=!!window.Audio,e.webAudio=!(!window.AudioContext&&!window.webkitAudioContext);var t=document.createElement("audio"),a=!1;try{(a=!!t.canPlayType)&&(t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(e.ogg=!0),(t.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")||t.canPlayType("audio/opus;").replace(/^no$/,""))&&(e.opus=!0),t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(e.mp3=!0),t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(e.wav=!0),(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;").replace(/^no$/,""))&&(e.m4a=!0),t.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(e.webm=!0))}catch(n){}}var a=e(navigator.userAgent),n={browser:a.browser,os:a.os,supportOrientation:"number"==typeof window.orientation&&"object"==typeof window.onorientationchange,supportTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportGeolocation:null!=navigator.geolocation,isAndroid:a.os.android,isIOS:a.os.ios,isPhone:a.os.phone,isTablet:a.os.tablet,isMobile:a.os.phone||a.os.tablet};return t(n),n}),a("ig/Game",["require","./Event","./util","./env","./Stage"],function(e){"use strict";function t(){var e=this,t=window.innerWidth,n=window.innerHeight,i=t/n,r=e.canvas.width/e.canvas.height,o=i>r?n/e.canvas.height:t/e.canvas.width,s=e.canvas.width*o,c=e.canvas.height*o;if(e.canvas.style.width=s+"px",e.canvas.style.height=c+"px",e.canvas.parentNode&&(e.canvas.parentNode.style.width=s+"px",e.canvas.parentNode.style.height=c+"px"),r>=i){var u=(n-c)/2;e.canvas.style.top=u+"px"}e.width=e.canvas.width,e.cssWidth=e.canvas.style.width,e.height=e.canvas.height,e.cssHeight=e.canvas.style.height,a.call(e)}function a(){var e=this;e.offCanvas||(e.offCanvas=document.createElement("canvas"),e.offCtx=e.offCanvas.getContext("2d")),e.offCanvas.width=e.canvas.width,e.offCanvas.style.width=e.canvas.style.width,e.offCanvas.height=e.canvas.height,e.offCanvas.style.height=e.canvas.style.height}function n(e){e=e||{},d.apply(this,arguments),this.name=null===e.name||void 0===e.name?"ig_game_"+v++:e.name,this.paused=!1,this.stageStack=[],this.stages={},p=e.fps||60}var i,r,o,s,c,u,l,h,d=e("./Event"),f=e("./util"),g=e("./env"),m=e("./Stage"),v=0,p=60;return n.prototype={constructor:n,init:function(e){var n=this;if(!e.canvas)throw new Error("Game init must be require a canvas param");n.canvas=f.domWrap(e.canvas,document.createElement("div"),"ig-stage-container"+v),n.canvas.width=e.width||320,n.canvas.height=e.height||480;var i=parseInt(n.canvas.width,10),r=parseInt(n.canvas.height,10),o=e.maxWidth||5e3,s=e.maxHeight||5e3;if(e.maximize){document.body.style.padding=0,document.body.style.margin=0;var c,u=f.getType(e.pageScroll);c="number"===u?e.pageScroll:"boolean"===u?17:0,i=e.width||Math.min(window.innerWidth,o)-c,r=e.height||Math.min(window.innerHeight-5,s)}g.supportTouch&&(n.canvas.style.height=2*r+"px",window.scrollTo(0,1),i=Math.min(window.innerWidth,o),r=Math.min(window.innerHeight,s)),n.ctx=n.canvas.getContext("2d"),n.canvas.style.height=r+"px",n.canvas.style.width=i+"px",n.canvas.width=i,n.canvas.height=r,n.canvas.style.position="relative",n.width=n.canvas.width,n.cssWidth=n.canvas.style.width,n.height=n.canvas.height,n.cssHeight=n.canvas.style.height,a.call(n);var l=n.canvas.parentNode;return l.style.width=i+"px",l.style.margin="0 auto",l.style.position="relative",window.addEventListener(g.supportOrientation?"orientationchange":"resize",function(){setTimeout(function(){window.scrollTo(0,1),e.scaleFit&&t.call(n)},0)},!1),n},start:function(){var e=this;e.paused=!1,r=Date.now(),i=0,o=1e3/p,s=0,c=Date.now(),u=0,l=0,h=0;var t="",a=f.noop,n=arguments.length;switch(n){case 1:"function"===f.getType(arguments[0])?a=arguments[0]:(t=arguments[0],a=f.noop);break;case 2:t=arguments[0],a=arguments[1]}if(t){for(var d=e.stageStack,g=-1,m=0,v=d.length;v>m;m++)if(d[m].name===t){g=m;break}e.swapStage(g,0)}return e.requestID=window.requestAnimationFrame(function(){e.render.call(e,t)}),"function"===f.getType(a)&&a.call(e,{data:{startTime:r,interval:o}}),e},render:function(){var e=this;if(e.requestID=window.requestAnimationFrame(function(e){return function(){e.render.call(e)}}(e)),!e.paused){if(i=Date.now(),s=i-r,s>o){h++,r=i-s%o,e.fire("beforeGameRender",{data:{startTime:r,totalFrameCounter:h}});var t=e.getCurrentStage();t&&(t.update(h),t.render()),e.fire("afterGameRender",{data:{startTime:r,totalFrameCounter:h}})}l>1e3?(c=Date.now(),l=0,e.fire("gameFPS",{data:{fps:u,totalFrameCounter:h}}),u=0):(l=Date.now()-c,++u)}},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this},stop:function(){return window.cancelAnimationFrame(this.requestID),this},getStageStack:function(){return this.stageStack},getStageByName:function(e){return this.stages[e]},createStage:function(e){var t=this;e=f.extend({},{canvas:t.canvas,offCanvas:t.offCanvas,game:t},e);var a=new m(e);return this.pushStage(a),a},pushStage:function(e){var t=this;t.getStageByName(e.name)||(e.gameOwner=t,t.stageStack.push(e),t.stages[e.name]=e,t.sortStageIndex())},popStage:function(){var e=this,t=e.stageStack.pop();t&&(delete e.stages[t.name],e.sortStageIndex())},sortStageIndex:function(){for(var e=this.stageStack,t=e.length-1,a=0;t>=0;t--,a++)e[t].zIndex=a},removeStageByName:function(e){var t=this,a=t.getStageByName(e);if(a){delete t.stages[a.name];var n=t.stageStack;f.removeArrByCondition(n,function(t){return t.name===e}),t.sortStageIndex()}},changeStage:function(e){var t=this;if(e){for(var a=t.stageStack,n=-1,i=0,r=a.length;r>i;i++)if(a[i].name===e){n=i;break}t.swapStage(n,0)}},swapStage:function(e,t){var a=this,n=a.stageStack,i=n.length;if(e>=0&&i-1>=e&&t>=0&&i-1>=t){var r=n[e];n[e]=n[t],n[t]=r,a.sortStageIndex()}a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height)},getStageIndex:function(e){return e.zIndex},getCurrentStage:function(){var e=this;return e.stageStack[0]},clearAllStage:function(){for(var e=this,t=0,a=e.stageStack.length;a>t;t++)e.stageStack[t].clean();e.stages={},e.stageStack=[]}},f.inherits(n,d),n}),a("ig/Stage",["require","./Event","./util","./DisplayObject"],function(e){"use strict";function t(e){var t=this;e.save(),e.fillStyle=e.createPattern(t.image,t.repeat),e.fillRect(t.x,t.y,e.canvas.width,e.canvas.height),e.restore(),u.src||(u.src=e.canvas.toDataURL(),t.image=u)}function a(e,t,a,n,i,r){var o=this,s=Math.abs(n.x)%i,c=Math.abs(n.y)%r,u=n.x<0?i-s:s,l=n.y<0?r-c:c,h=a.width<i-u?a.width:i-u,d=a.height<r-l?a.height:r-l;return e.drawImage(o.image,u,l,h,d,t.x,t.y,h,d),{width:h,height:d}}function n(){var e=this,n=e.parallax;if(n){var i=e.offCtx;"no-repeat"!==n.repeat&&t.call(n,i);for(var r=n.image.width,o=n.image.height,s={width:0,height:0},c=0;o>c;c+=s.height)for(var u=0;r>u;u+=s.width){var l={x:n.x+u,y:n.y+c},h={width:r-u,height:o-c},d={x:0,y:0};0===u&&(d.x=n.vX),0===c&&(d.y=n.vY),s=a.call(n,i,l,h,d,r,o)}}}function i(e){var t=this,a=t.parallax;a&&(a.anims&&"array"===s.getType(a.anims)?(a.animInterval=a.animInterval||1e4,a.curAnim||(a.curAnim=a.anims[0]),e%a.animInterval===0&&(void 0===a.time&&(a.time=0),a.time++,a.time===a.anims.length&&(a.time=0),a.curAnim=a.anims[a.time])):a.curAnim={aX:a.aX,aY:a.aY},a.vX=(a.vX+a.curAnim.aX)%a.image.width,a.vY=(a.vY+a.curAnim.aY)%a.image.height)}function r(e){o.apply(this,arguments),e=e||{},this.name=null===e.name||void 0===e.name?"ig_stage_"+l++:e.name,this.displayObjectList=[],this.displayObjects={},this.canvas=e.canvas,this.ctx=e.canvas.getContext("2d"),this.offCanvas=e.offCanvas,this.offCtx=e.offCanvas.getContext("2d"),this.width=e.game.width,this.height=e.game.height,this.cssWidth=e.game.cssWidth,this.cssHeight=e.game.cssHeight}var o=e("./Event"),s=e("./util"),c=e("./DisplayObject"),u=new Image,l=0;return r.prototype={constructor:r,clear:function(){var e=this;return e.offCtx.clearRect(0,0,e.width,e.height),e},setBgColor:function(e){var t=this;return t.bgColor=e,t},setBgImg:function(e,t){var a,n=this;"htmlimageelement"===s.getType(e)?a=e.src:"string"===s.getType(e)&&(a=e);var i="url("+a+")",r="",o="",c="";switch(t){case"center":r="no-repeat",o="center";break;case"full":c=n.cssWidth+"px "+n.cssHeight+"px"}return n.bgImg={bgUrl:i,bgRepeat:r,bgPos:o,bgSize:c},n},setParallaxScroll:function(e){var t=this;if(e=e||{},!e.image)throw new Error("ParallaxScroll must be require a image param");e.repeat=e.repeat&&-1!==["repeat","repeat-x","repeat-y"].indexOf(e.repeat)?e.repeat:"no-repeat",t.parallax=s.extend({},{x:0,y:0,vX:0,vY:0,aX:0,aY:0},e)},update:function(e){var t=this;i.call(t,e);for(var a,n=t.displayObjectList,r=n.length,o=0;r>o;o++)a=t.displayObjectList[o].status,(1===a||2===a)&&this.displayObjectList[o].update()},render:function(){var e=this;e.clear(),e.fire("beforeStageRender"),e.sortDisplayObject();var t,a=e.displayObjectList,i=a.length;e.offCtx.save(),e.offCtx.clearRect(0,0,e.offCanvas.width,e.offCanvas.height),e.canvas.style.backgroundColor=e.bgColor?e.bgColor:"",e.bgImg?(e.canvas.style.backgroundImage=e.bgImg.bgUrl,e.canvas.style.backgroundRepeat=e.bgImg.bgRepeat,e.canvas.style.backgroundPosition=e.bgImg.bgPos,e.canvas.style.backgroundSize=e.bgImg.bgSize):e.canvas.style.backgroundImage="",n.call(e);for(var r=0;i>r;r++)t=e.displayObjectList[r].status,(1===t||3===t)&&e.displayObjectList[r].render(e.offCtx);e.offCtx.restore(),e.ctx.drawImage(e.offCanvas,0,0),e.fire("afterStageRender")},renderDisplayObject:function(){var e,t=this,a=t.displayObjectList,n=a.length;t.offCtx.save(),t.offCtx.clearRect(0,0,t.offCanvas.width,t.offCanvas.height);for(var i=0;n>i;i++)e=t.displayObjectList[i].status,(1===e||3===e)&&t.displayObjectList[i].render(t.offCtx);t.offCtx.restore(),t.ctx.drawImage(t.offCanvas,0,0)},sortDisplayObject:function(){this.displayObjectList.sort(function(e,t){return e.zIndex-t.zIndex})},getDisplayObjectList:function(){return this.displayObjectList},getDisplayObjectByName:function(e){return this.displayObjects[e]},createDisplayObject:function(e){var t=new c(e);return this.addDisplayObject(t),t},addDisplayObject:function(e){var t=this;e&&!t.getDisplayObjectByName(e.name)&&(e.stageOwner=t,t.displayObjectList.push(e),t.displayObjects[e.name]=e)},removeDisplayObject:function(e){e&&this.removeDisplayObjectByName(e.name)},removeDisplayObjectByName:function(e){var t=this,a=t.displayObjects[e];if(a){delete t.displayObjects[a.name];var n=t.displayObjectList;s.removeArrByCondition(n,function(t){return t.name===e})}},clearAllDisplayObject:function(){this.displayObjectList=[],this.displayObjects={}}},s.inherits(r,o),r}),a("ig/DisplayObject",["require","./Event","./util"],function(e){"use strict";function t(e){var t=this;e=e||{},a.apply(t,arguments),t.name=null===e.name||void 0===e.name?"ig_displayobject_"+i++:e.name,t.stageOwner=null,t.x=e.x||0,t.y=e.y||0,t.width=e.width||0,t.height=e.height||0,t.radius=e.radius||0,t.scaleX=e.scaleX||1,t.scaleY=e.scaleY||1,t.angle=e.angle||0,t.alpha=e.alpha||1,t.zIndex=e.zIndex||0,t.fillStyle=e.fillStyle||null,t.strokeStyle=e.strokeStyle||null,t.image=e.image||null,t.vX=e.vX||0,t.vY=e.vY||0,t.aX=e.aX||0,t.aY=e.aY||0,t.frictionX=e.frictionX||1,t.frictionY=e.frictionY||1,t.reverseVX=!1,t.reverseVY=!1,t.status=1,t.customProp=e.customProp||{},t.debug=!1,t.setPos(t.x,t.y)}var a=e("./Event"),n=e("./util"),i=0;return t.prototype={constructor:t,setPos:function(e,t){var a=this;a.x=e||a.x,a.y=t||a.y},setAcceleration:function(e,t){var a=this;a.aX=e||a.aX,a.aY=t||a.aY},setAccelerationX:function(e){var t=this;t.aX=e||t.aX},setAccelerationY:function(e){var t=this;t.aY=e||t.aY},resetAcceleration:function(){var e=this;e.aX=0,e.aY=0},move:function(e,t){var a=this;a.x+=e,a.y+=t},moveStep:function(){var e=this;e.vX+=e.aX,e.vX*=e.frictionX,e.x+=e.vX,e.vY+=e.aY,e.vY*=e.frictionY,e.y+=e.vY},setFrictionX:function(e){var t=this;t.frictionX=e},setFrictionY:function(e){var t=this;t.frictionY=e},rotate:function(){var e=this,t=e.stageOwner.offCtx;t.save(),t.rotate(n.deg2Rad(e.angle)),t.restore()},update:function(){return!0},render:function(){return!0},isHit:function(e){var t=this,a=t.x>e.x?t.x:e.x,n=t.x+t.width<e.x+e.width?t.x+t.width:e.x+e.width,i=t.y>e.y?t.y:e.y,r=t.y+t.width<e.y+e.width?t.y+t.width:e.y+e.width;return n>=a&&r>=i},isMouseIn:function(e){var t=this,a=e.x,n=e.y,i=t.stageOwner,r=i.x||0,o=i.y||0;a-r>=t.x-t.radius&&a-r<=t.x+t.radius&&n-o>=t.y-t.radius&&n-o<=t.y+t.radius&&console.warn("你碰到我了")}},n.inherits(t,a),t}),a("ig/SpriteSheet",["require","./util","./DisplayObject"],function(e){"use strict";function t(e){if(e=e||{},!e.image)throw new Error("SpriteSheet must be require a image param");n.apply(this,arguments),this.name=null===e.name||void 0===e.name?"ig_spritesheet_"+i++:e.name,this.relativeX=e.relativeX||0,this.relativeY=e.relativeY||0,this.frameWidth=e.frameWidth||32,this.frameHeight=e.frameHeight||32,this.total=e.total||1,this.totalBackup=this.total,this.frameIndex=0,this.frameStartX=e.frameStartX||0,this.frameStartXBackup=this.frameStartX,this.frameStartY=e.frameStartY||0,this.frameStartYBackup=this.frameStartY,this.offsets=e.offsets,this._offsetX=0,this._offsetY=0,this._offsetWidth=0,this._offsetHeight=0,r=0}var a=e("./util"),n=e("./DisplayObject"),i=0,r=0;return t.prototype={constructor:t,update:function(){var e=this;r%1===0&&(e._offsetX=0,e._offsetY=0,e._offsetWidth=0,e._offsetHeight=0,e.offsets&&e.offsets[e.frameIndex]&&(e._offsetX=e.offsets[e.frameIndex].x||0,e._offsetY=e.offsets[e.frameIndex].y||0,e._offsetWidth=e.offsets[e.frameIndex].width||0,e._offsetHeight=e.offsets[e.frameIndex].height||0),e.relativeX=e.frameStartX*e.frameWidth+e.frameIndex*e.frameWidth+e._offsetX,e.relativeY=e.frameStartY*e.frameHeight+e._offsetY,e.frameIndex++,e.frameIndex>=e.total&&(e.frameIndex=0,e.frameStartY=e.frameStartYBackup,e.total=e.totalBackup),e.frameIndex*e.frameWidth>=e.image.width&&(e.frameStartY++,e.total=e.total-e.frameIndex,e.frameIndex=0)),r++},render:function(e){var t=this;e.save(),e.globalAlpha=t.alpha,e.translate(t.x,t.y),e.rotate(a.deg2Rad(t.angle)),e.scale(t.scaleX,t.scaleY),e.drawImage(t.image,t.relativeX,t.relativeY,t.frameWidth+t._offsetWidth,t.frameHeight+t._offsetHeight,-t.frameWidth/2,-t.frameHeight/2,t.frameWidth+t._offsetWidth,t.frameHeight+t._offsetHeight),e.restore()}},a.inherits(t,n),t}),a("ig/Shape/Ball",["require","../util","../DisplayObject"],function(e){"use strict";function t(){var e=this;n.apply(e,arguments)}var a=e("../util"),n=e("../DisplayObject");return t.prototype={constructor:t,update:function(){var e=this,t=e.stageOwner.width,a=e.stageOwner.height;(e.x<e.radius||e.x>t-e.radius)&&(e.vX=-e.vX),(e.y<e.radius||e.y>a-e.radius)&&(e.vY=-e.vY),e.moveStep(),e.bBox.x=e.x,e.bBox.y=e.y},render:function(e){e.save(),e.beginPath(),e.fillStyle=this.color,e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.fill(),e.restore(),this.bBox.color="red",this.checkCollide(),this.bBox.show(e)},setBBox:function(e){this.bBox=e},checkCollide:function(){for(var e=this,t=e.stageOwner.displayObjectList,a=t.length,n=0;a>n;n++)e.name!==t[n].name&&e.bBox.isCollide(t[n].bBox)&&"yellow"!==e.bBox.color&&(console.warn(1),e.bBox.color="yellow",t[n].bBox.color="yellow")}},a.inherits(t,n),t}),a("ig/resourceLoader",["require","./ig","./util"],function(e){function t(e){var t=e.split(".");return t[t.length-1].toLowerCase()}var a=e("./ig"),n=e("./util"),i={png:"Image",jpg:"Image",gif:"Image",jpeg:"Image",ogg:"Audio",wav:"Audio",m4a:"Audio",mp3:"Audio"};a.resources={},a.loadOther=function(){var e,a,i,r,o=arguments.length;switch(o){case 1:e=a=arguments[0],i=r=n.noop;break;case 2:e=a=arguments[0],i=r=arguments[1];break;case 3:e=a=arguments[0],i=arguments[1],r=arguments[2];break;default:e=arguments[0],a=arguments[1],i=arguments[2],r=arguments[3]}var s=t(a),c=new XMLHttpRequest;c.onreadystatechange=function(){4===c.readyState&&(200===c.status?"json"===s?i(e,JSON.parse(c.responseText)):i(e,c.responseText):r(a))},c.open("GET",a,!0),c.send(null)},a.loadImage=function(){var e,t,a,i,r=arguments.length;switch(r){case 1:e=t=arguments[0],a=i=n.noop;break;case 2:e=t=arguments[0],a=i=arguments[1];break;case 3:e=t=arguments[0],a=arguments[1],i=arguments[2];break;default:e=arguments[0],t=arguments[1],a=arguments[2],i=arguments[3]}var o=new Image;o.addEventListener("load",function(){a(e,o)}),o.addEventListener("error",function(){i(t)}),o.src=t},a.loadResource=function(e,r,o){var s=this;o=o||{},Array.isArray(e)||(e=[e]);for(var c=!1,u=function(e){c=!0,(o.errorCallback||function(e){throw"Loading Error: "+e}).call(s,e)},l=o.processCallback||n.noop,h=e.length,d=h,f=function(e,t){c||(a.resources[e]||(a.resources[e]=t),d--,l(h-d,h),0===d&&r&&r.call(s,a.resources))},g=o.customResourceTypes||{},m=n.extend({},i,g),v=0;h>v;v++){var p,w,y=e[v];"object"===n.getType(y)?(p=y.id,w=y.src):p=w=y;var b=s["load"+m[t(w)]];b||(b=s.loadOther),b(p,w,f,u)}}});var n,i=t("ig"),r="ig/util",o="util",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/Event",o="Event",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/env",o="env",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/Game",o="Game",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/Stage",o="",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/DisplayObject",o="DisplayObject",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/SpriteSheet",o="SpriteSheet",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/Shape/Ball",o="Ball",s="Shape";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n));var n,r="ig/resourceLoader",o="",s="";s?(n={},n[o]=t(r),i[s]=n):(n=t(r),o&&(i[o]=n)),e.ig=i}(window);